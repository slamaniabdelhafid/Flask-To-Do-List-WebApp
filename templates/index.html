{% extends "base.html" %}
{% block title %}Todo List{% endblock %}

{% block content %}

<!-- TOP BAR -->
<div class="top-bar">
    <input
        type="text"
        id="searchInput"
        placeholder="ðŸ” Search tasks..."
    >
    <button class="dark-toggle" onclick="toggleDarkMode()">ðŸŒ™</button>
</div>

<!-- PROGRESS BAR -->
<div class="progress-container">
    <div class="progress-bar" id="progressBar"></div>
</div>

<!-- ADD TASK -->
<form class="task-form" method="POST">
    <input type="text" name="task" placeholder="Add a new task..." required>

    <select name="category">
        <option value="">No Category</option>
        {% for c in categories %}
            <option value="{{ c.id }}">{{ c.name }}</option>
        {% endfor %}
    </select>

    <select name="priority">
        <option value="1">Low</option>
        <option value="2">Medium</option>
        <option value="3">High</option>
    </select>

    <input type="date" name="due_date">
    <button type="submit">+</button>
</form>

<!-- FILTERS -->
<div class="filters">
    <a href="/?completed=all">All</a>
    <a href="/?completed=completed">Completed</a>
    <a href="/?completed=pending">Pending</a>
</div>

<!-- WEEK VIEW (UI ONLY) -->
<div class="week-view">
    <div class="day">Mon</div>
    <div class="day">Tue</div>
    <div class="day">Wed</div>
    <div class="day">Thu</div>
    <div class="day">Fri</div>
    <div class="day">Sat</div>
    <div class="day">Sun</div>
</div>

<!-- TASK LIST -->
<ul class="task-list" id="taskList">

{% for task in tasks %}
{% set border_color = task.category.color if task.category else '#bdc3c7' %}

<li class="task-card {% if task.completed %}done{% endif %}"
    data-text="{{ task.content | lower }}"
    style="border-left: 6px solid "{{ border_color }}">

    <div class="task-left">
        <input type="checkbox"
               {% if task.completed %}checked{% endif %}
               onclick="toggleTask"({{ task.id }}, this)">

        <div class="task-content">
            <div class="task-text">
                {{ task.content }}
            </div>

            <div class="task-meta">
                {% if task.category %}
                    <span class="tag">{{ task.category.name }}</span>
                {% endif %}

                <span class="priority p{{ task.priority }}">
                    Priority {{ task.priority }}
                </span>

                {% if task.due_date %}
                    <span class="due">
                        ðŸ“… {{ task.due_date.date() }}
                    </span>
                {% endif %}
            </div>
        </div>
    </div>

    <a href="/delete/{{ task.id }}" class="delete">ðŸ—‘</a>
</li>

{% endfor %}
</ul>

{% if tasks|length == 0 %}
<div class="empty">
    No tasks yet. Add one above ðŸ‘†
</div>
{% endif %}

<!-- SCRIPTS -->
<script>
/* SEARCH */
document.getElementById("searchInput").addEventListener("input", function () {
    const value = this.value.toLowerCase();
    document.querySelectorAll(".task-card").forEach(card => {
        card.style.display = card.dataset.text.includes(value) ? "flex" : "none";
    });
});

/* DARK MODE */
function toggleDarkMode() {
    document.body.classList.toggle("dark");
}

/* PROGRESS BAR */
(function updateProgress() {
    const tasks = document.querySelectorAll(".task-card");
    const completed = document.querySelectorAll(".task-card.done");
    const percent = tasks.length ? (completed.length / tasks.length) * 100 : 0;
    document.getElementById("progressBar").style.width = percent + "%";
})();
</script>

{% endblock %}
